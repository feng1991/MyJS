<html>
<head>
<style type="text/css">
	#area_div{
		width:500px;
		margin:0 auto;
	}
	.area{
		width:100px;
		height:100px;
		display:block;
		float:left;
		border:1px solid #fff;
		background-color: #abcdef;
	}
	.flag{
		background-color: #FF9900;
	}
	.on{
		background-color: #9acd32;
	}
	.dead{
		background-color: #ff6347;
	}
</style>
</head>
<body>
	<div id='area_div'>
	<span class="area" id="area1"></span>
	<span class="area" id="area2"></span>
	<span class="area" id="area3"></span>
	<span class="area" id="area4"></span><br/>
	<span class="area" id="area5"></span>
	<span class="area" id="area6"></span>
	<span class="area" id="area7"></span>
	<span class="area" id="area8"></span>
	<span class="area" id="area9"></span>
	<span class="area" id="area10"></span>
	<span class="area" id="area11"></span>
	<span class="area" id="area12"></span>
	<span class="area" id="area13"></span>
	<span class="area" id="area14"></span>
	<span class="area" id="area15"></span>
	<span class="area" id="area16"></span>
	</div>
</body>
</html>
<script type="text/javascript">

function $(s) {
	return document.querySelector(s);
};
function $$(s){
	return document.querySelectorAll(s);
}
Math.mt_rand = function(min,max){
	if(arguments.length == 1){
		max = min;
		min = 1;
	}
	return min + Math.floor( Math.random() * (max-min) );
}
Element.prototype.addClass = function(className){
	this.className += '  '+className;
}
Element.prototype.hasClass = function(className){
	return this.className.match( new RegExp( "(\\s|^)" + className + "(\\s|$)") );
}
Element.prototype.removeClass = function(className){
	this.className = this.className.replace( new RegExp( "(\\s|^)" + className + "(\\s|$)" ) , '');
}
Element.prototype.toggleClass = function(className){
	if(this.hasClass(className)){
		this.removeClass(className);
	}else{
		this.addClass(className);	
	}
}













//stop the  menu
document.oncontextmenu=function(){
	return false;
};


var setting = {
	'count' : 16,
	'mine_count' : 3,
	'mine_location' : []
};
var all_area = $$('.area');
//initialize the location of mines
for(var i = 0;i < setting.mine_count;i = i){
	var num = Math.mt_rand(setting.count);
	if(-1 == setting.mine_location.indexOf(num) ){
		setting.mine_location.push(num);
		i++;
	}
}
//to see all mines
console.log(setting.mine_location);
//bind mouse event
for(var i in all_area){
	all_area[i].onmouseup = function(e){
		var choose = parseInt(this.id.slice(4));
		if(e.button == 2){
		//right mouse button
			if( !this.hasClass('on')  ){
				this.toggleClass('flag');
			}
		}else if(e.button == 0){
		//left mouse button
			if( this.hasClass('on') || this.hasClass('flag') ){
				return false;
			}
			if(-1 != setting.mine_location.indexOf(choose)){
				this.addClass('dead');
			}else{
				if( isShow() ){
					showTip(choose);
				}
				this.addClass('on');
			}
		}
		getResult();
	}
}
//whether to show tips
function isShow(){
	if( Math.mt_rand(10) > 5 ){
		return true;
	}else{
		return false;
	}
}
//show tips
function showTip(choose){
	var toOpen =getAround(choose);
	//console.log(toOpen);
	for(var i=0;i<toOpen.length;i++){
		if( -1 == setting.mine_location.indexOf(toOpen[i]) ){
			var areaChoose = $('#area'+toOpen[i]);
			if( !areaChoose.hasClass('on') && !areaChoose.hasClass('flag') ){
				areaChoose.addClass('on');
			}
		}
	}
}
//get around: up,down,left,right
function getAround(choose){
	var base = Math.sqrt(setting.count);
	var list = choose % base;
	var row = Math.ceil( choose / base );
	var toOpen = [];
	if(list == 0){
	//has left
		toOpen.push(choose -1);
	}else if(list == 1){
	//has right
		toOpen.push(choose +1);
	}else{
	//has left and right
		toOpen.push(choose - 1);
		toOpen.push(choose +1);
	}
	if( row == 1){
	//has down
		toOpen.push(choose + base);
	}else if( row == base){
	//has up
		toOpen.push(choose - base);
	}else{
	//has up and down
		toOpen.push(choose + base);
		toOpen.push(choose - base);
	}
	return toOpen;
}
//decide win or fail
function getResult(){
	var dead_count = $$('.area.dead').length;
	if(dead_count > 0){
		alert('fail');
	}
	if(  ($$('.area.on').length + $$('.area.flag').length + dead_count)  >= setting.count ){
		if(dead_count == 0){
			alert('win');
		}else{
			alert('fail');
		}
	}
}

</script>